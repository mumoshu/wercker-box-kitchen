name: kitchen
version: 0.0.3
inherits: wercker/ubuntu12.04-webessentials@1.0.4
type: main
platform: ubuntu@12.04
description: wercker box for running integration tests using Test Kitchen, Vagrant, Berkshelf
keywords:
  - vagrant
  - berkshelf
  - test-kitchen
  - virtualbox
no-response-timeout: 10
steps:
  - dannyrscott/slack-notify@1.1.2
script: |
  sudo chef-solo -c $WERCKER_SOURCE_DIR/solo.rb -j $WERCKER_SOURCE_DIR/solo.json -l debug
script: |
  export GEM_OPTS='--no-ri --no-rdoc'

  sudo gem install bundler ${GEM_OPTS}
  bundle version

  sudo gem install berkshelf ${GEM_OPTS}
  berks version

  sudo gem install test-kitchen ${GEM_OPTS}

  # @see http://www.binarytides.com/install-virtualbox-4-3-ubuntu/
  # @see http://www.joeyconway.com/blog/2014/05/23/ubuntu-virtualbox-repository-configuration/
  sudo sh -c "echo 'deb http://download.virtualbox.org/virtualbox/debian '$(lsb_release -cs)' contrib non-free' > /etc/apt/sources.list.d/virtualbox.list"
  wget -q http://download.virtualbox.org/virtualbox/debian/oracle_vbox.asc -O- | sudo apt-key add -
  sudo apt-get update
  sudo apt-get install virtualbox-4.3
  VBoxManage -v

  export VAGRANT_VERSION=1.6.3
  wget https://dl.bintray.com/mitchellh/vagrant/vagrant_${VAGRANT_VERSION}_x86_64.deb
  sudo dpkg -i vagrant_${VAGRANT_VERSION}_x86_64.deb
deploy:
  after-steps:
    slack-notify:
      subdomain: $WERCKER_SLACK_NOTIFY_SUBDOMAIN
      token: $WERCKER_SLACK_NOTIFY_TOKEN
      channel: $WERCKER_SLACK_NOTIFY_CHANNEL
